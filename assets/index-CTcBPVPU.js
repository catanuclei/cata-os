var pe=Object.defineProperty;var ge=(s,e,t)=>e in s?pe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var r=(s,e,t)=>ge(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const z={DISPLAY_NAME:"CataOS",VERSION:"0.0.1",AUTHOR:"catanuclei",COPYRIGHT_YEAR:"2024"},se=(()=>{const s=[];for(let e=0;e<10;e++)s.push(e.toString());for(let e=0;e<26;e++)s.push(String.fromCharCode(97+e));for(let e=0;e<26;e++)s.push(String.fromCharCode(65+e));return s})(),fe=s=>{const e=document.createElement("span"),t=document.createElement("span");e.innerHTML=`${z.DISPLAY_NAME} ${z.VERSION}`,t.innerHTML=`${z.AUTHOR} &copy; ${z.COPYRIGHT_YEAR}`,s.appendChild(e),s.appendChild(t)},ee=(s,e="")=>{const t=document.createElement("span");return e&&t.classList.add(e),t.classList.add("bi",`bi-${s}`),t};var H=(s=>(s.FOCUS="CATA::FOCUS_EV",s.MAXIMIZE="CATA::MAXIMIZE_EV",s.UNMAXIMIZE="CATA::UNMAXIMIZE_EV",s))(H||{});const de=s=>new CustomEvent("CATA::FOCUS_EV",{bubbles:!1,detail:{key:s}}),Ee=s=>new CustomEvent("CATA::MAXIMIZE_EV",{bubbles:!1,detail:{key:s}}),ae=(s,e=!0)=>new CustomEvent("CATA::UNMAXIMIZE_EV",{bubbles:!1,detail:{key:s,shift:e}}),xe="window",re="window--focused",Me="window__title",Le="window__title__icon",Ne="window__title__text",Ce="window__title__buttons",ce="window__title__button",te="window__title__maximize",Se="window__title__close",We="window__content",x="window__resize-box",Oe="window__resize-box--top",Ie="window__resize-box--right",ve="window__resize-box--bottom",Te="window__resize-box--left",be="window__resize-box--top-left",Ae="window__resize-box--top-right",Re="window__resize-box--bottom-left",ye="window__resize-box--bottom-right",Be=6,$="context-menu",le="context-menu__item";class ze{constructor(e,t){r(this,"_managerNode");r(this,"_desktopNode");r(this,"_contextNode");r(this,"_windowMap");r(this,"_focusKey");r(this,"_isContextOpen");r(this,"_desktopContextItems");r(this,"_windowManagerWidth");r(this,"_windowManagerHeight");r(this,"createWindow",(e,t,i=null,n={x:0,y:0},o={width:96,height:72})=>{let d=this._generateWindowKey();for(;this._windowMap[d];)d=this._generateWindowKey();const _=Object.values(this._windowMap).length?Object.values(this._windowMap).sort((g,m)=>m.order-g.order)[0].order+1:0,v={title:e,icon:t,minDimensions:o,order:_,_premaximizeRect:null},Y=$e(v,i,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0},d,this.maximizeWindow,this.closeWindow,this.focusWindow,(g,m,U)=>this.openContextMenu([{text:"Close",handler:()=>this.closeWindow(g)}],m,U),this.closeContextMenu,()=>!this._isContextOpen,()=>{var g;return!!((g=this._windowMap[d])!=null&&g._premaximizeRect)},()=>({width:this._windowManagerWidth,height:this._windowManagerHeight}));return this._managerNode.appendChild(Y),this._windowMap[d]=v,this._shiftAndScaleOutOfBoundsWindow(d),this.focusWindow(d),{key:d}});r(this,"maximizeWindow",(e,t=!0)=>{if(this._windowMap[e]){if(!this._windowMap[e]._premaximizeRect){this._managerNode.dispatchEvent(de(e)),this._managerNode.dispatchEvent(Ee(e));return}this._managerNode.dispatchEvent(ae(e,t))}});r(this,"unmaximizeWindow",(e,t=!0)=>{this._windowMap[e]&&this._managerNode.dispatchEvent(ae(e,t))});r(this,"closeWindow",e=>{var i;if(!this._windowMap[e])return;(i=this._managerNode.querySelector(`[data-key="${e}"]`))==null||i.remove();const t=this._windowMap[e].order;Object.keys(this._windowMap).forEach(n=>{this._windowMap[n].order>t&&this._windowMap[n].order--}),delete this._windowMap[e]});r(this,"focusWindow",e=>{!this._windowMap[e]||this._focusKey===e||this._managerNode.dispatchEvent(de(e))});r(this,"openContextMenu",(e,t,i)=>{if(this.closeContextMenu(),!e.length)return;e.forEach(d=>{const _=document.createElement("li");_.innerHTML=d.text,_.classList.add(le),this._contextNode.appendChild(_)}),this._isContextOpen=!0,this._contextNode.classList.add(`${$}--shown`);const n=t+this._contextNode.offsetWidth>this._windowManagerWidth?t-this._contextNode.offsetWidth:t,o=i+this._contextNode.offsetHeight>this._windowManagerHeight?i-this._contextNode.offsetHeight:i;[...this._contextNode.children].forEach((d,_)=>{d.onclick=()=>{e[_].handler({menuPosition:{x:n,y:o}}),this.closeContextMenu()}}),this._contextNode.style.translate=`${n}px ${o}px`});r(this,"setDesktopContextMenu",e=>{this._desktopContextItems=e});r(this,"closeContextMenu",()=>{this._isContextOpen&&(this._contextNode.innerHTML="",this._contextNode.classList.remove(`${$}--shown`),this._isContextOpen=!1)});r(this,"_setupContextNode",()=>{this._contextNode.classList.add($),this._desktopNode.appendChild(this._contextNode)});r(this,"_generateWindowKey",()=>{let e="";for(let t=0;t<Be;t++)e+=se[Math.floor(Math.random()*se.length)];return e});r(this,"_focusWindow",e=>{if(e===null){[...this._managerNode.querySelectorAll("[data-key]")].forEach(n=>{n.classList.remove(re)});return}const t=this._windowMap[e].order,i=Object.values(this._windowMap).sort((n,o)=>o.order-n.order)[0].order;Object.keys(this._windowMap).forEach(n=>{this._windowMap[n].order>t&&this._windowMap[n].order--}),this._windowMap[e].order=i,[...this._managerNode.querySelectorAll("[data-key]")].forEach(n=>{const o=n.dataset.key;n.style.zIndex=(this._windowMap[o].order+1).toString(),n.classList[e===o?"add":"remove"](re)})});r(this,"_maximizeWindow",e=>{const t=this._managerNode.querySelector(`[data-key="${e}"]`);this._windowMap[e]._premaximizeRect=t.getBoundingClientRect(),t.style.translate="0px 0px",t.style.width=`${this._windowManagerWidth}px`,t.style.height=`${this._windowManagerHeight}px`;const i=t.querySelector(`.${te}`);i.classList.remove("bi-arrows-angle-expand"),i.classList.add("bi-arrows-angle-contract")});r(this,"_unmaximizeWindow",(e,t=!0)=>{const i=this._windowMap[e]._premaximizeRect;if(!i)return;const n=this._managerNode.querySelector(`[data-key="${e}"]`);t&&(n.style.translate=`${i.left}px ${i.top}px`,n.style.width=`${i.width}px`,n.style.height=`${i.height}px`);const o=n.querySelector(`.${te}`);o.classList.remove("bi-arrows-angle-contract"),o.classList.add("bi-arrows-angle-expand"),this._windowMap[e]._premaximizeRect=null,this._shiftAndScaleOutOfBoundsWindow(e)});r(this,"_shiftAndScaleOutOfBoundsWindows",()=>{[...this._managerNode.querySelectorAll("[data-key]")].forEach(e=>{const t=e.dataset.key,i=e.getBoundingClientRect(),n=this._windowMap[t]._premaximizeRect;let o=i.left,d=i.top;i.width>this._windowManagerWidth&&(e.style.width=`${this._windowManagerWidth}px`),i.height>this._windowManagerHeight&&(e.style.height=`${this._windowManagerHeight}px`),i.left>this._windowManagerWidth-e.offsetWidth?o=this._windowManagerWidth-e.offsetWidth:i.left<0&&(o=0),i.top>this._windowManagerHeight-e.offsetHeight?d=this._windowManagerHeight-e.offsetHeight:i.top<0&&(d=0);const _=e.getBoundingClientRect();n&&(this._windowManagerWidth>_.width||this._windowManagerHeight>_.height)&&this._unmaximizeWindow(t,!1),e.style.translate=`${o}px ${d}px`})});r(this,"_shiftAndScaleOutOfBoundsWindow",e=>{if(!this._windowMap[e])return;const t=this._managerNode.querySelector(`[data-key="${e}"]`),i=t.getBoundingClientRect(),n=this._windowMap[e]._premaximizeRect;let o=i.left,d=i.top;i.width>this._windowManagerWidth&&(t.style.width=`${this._windowManagerWidth}px`),i.height>this._windowManagerHeight&&(t.style.height=`${this._windowManagerHeight}px`),i.left>this._windowManagerWidth-t.offsetWidth?o=this._windowManagerWidth-t.offsetWidth:i.left<0&&(o=0),i.top>this._windowManagerHeight-t.offsetHeight?d=this._windowManagerHeight-t.offsetHeight:i.top<0&&(d=0);const _=t.getBoundingClientRect();n&&(this._windowManagerWidth>_.width||this._windowManagerHeight>_.height)&&this._unmaximizeWindow(e,!1),t.style.translate=`${o}px ${d}px`});r(this,"_initializeEventListeners",()=>{this._managerNode.addEventListener(H.FOCUS,e=>{const t=e.detail.key;this._focusWindow(t)}),this._managerNode.addEventListener(H.MAXIMIZE,e=>{const t=e.detail.key;this._maximizeWindow(t)}),this._managerNode.addEventListener(H.UNMAXIMIZE,e=>{const t=e.detail.key,i=e.detail.shift;this._unmaximizeWindow(t,i??!0)})});const i=e.getBoundingClientRect();this._managerNode=e,this._desktopNode=t,this._contextNode=document.createElement("ul"),this._windowMap={},this._focusKey=null,this._isContextOpen=!1,this._desktopContextItems=[],this._windowManagerWidth=i.width,this._windowManagerHeight=i.height,this._setupContextNode();let n;window.addEventListener("resize",()=>{const o=this._managerNode.getBoundingClientRect();this._windowManagerWidth=o.width,this._windowManagerHeight=o.height,clearTimeout(n),n=setTimeout(this._shiftAndScaleOutOfBoundsWindows,150)}),window.addEventListener("mousedown",o=>{o.target.classList.contains($)||o.target.classList.contains(le)||this.closeContextMenu()}),this._managerNode.addEventListener("contextmenu",o=>{o.preventDefault(),this.openContextMenu(this._desktopContextItems,o.clientX,o.clientY)}),this._managerNode.addEventListener("mousedown",()=>{this._focusWindow(null)}),this._contextNode.addEventListener("contextmenu",o=>{o.preventDefault()}),this._initializeEventListeners()}}const $e=({title:s,icon:e,minDimensions:t,order:i},n,o,d,_,v,Y,g,m,U,we,ne)=>{const c=document.createElement("div"),M=document.createElement("p"),Z=document.createElement("span"),P=document.createElement("span"),T=document.createElement("div"),b=document.createElement("button"),ue=ee("arrows-angle-expand",te),A=document.createElement("button"),me=ee("x-lg",Se),q=document.createElement("div"),F=document.createElement("div"),K=document.createElement("div"),V=document.createElement("div"),j=document.createElement("div"),G=document.createElement("div"),J=document.createElement("div"),Q=document.createElement("div"),k=document.createElement("div");F.classList.add(x,Oe),K.classList.add(x,Ie),V.classList.add(x,ve),j.classList.add(x,Te),G.classList.add(x,be),J.classList.add(x,Ae),Q.classList.add(x,Re),k.classList.add(x,ye),c.classList.add(xe),M.classList.add(Me),Z.classList.add(Le),P.classList.add(Ne),T.classList.add(Ce),b.classList.add(ce),A.classList.add(ce),q.classList.add(We),e&&Z.appendChild(ee(e)),P.innerHTML=s,b.appendChild(ue),A.appendChild(me),T.appendChild(b),T.appendChild(A),e&&M.appendChild(Z),M.appendChild(P),M.appendChild(T),n&&n.forEach(a=>{q.appendChild(a)}),M.addEventListener("mousedown",a=>{const L=c.offsetWidth,l=c.offsetHeight,S=c.getBoundingClientRect(),N=a.clientX-S.left,W=a.clientY-S.top,C=ne(),O=u=>{if(!U())return;const R=u.clientY-W<0?0:u.clientY-W>=C.height-l?C.height-l:u.clientY-W,y=u.clientX-N<0?0:u.clientX-N>=C.width-L?C.width-L:u.clientX-N;c.style.translate=`${y}px ${R}px`},E=()=>{document.removeEventListener("mousemove",O),document.removeEventListener("mouseup",E)};m(),document.addEventListener("mousemove",O),document.addEventListener("mouseup",E)}),M.addEventListener("dblclick",a=>{a.stopPropagation(),m(),_(d,!0)}),c.addEventListener("mousedown",a=>{a.stopPropagation(),m(),Y(d)}),c.addEventListener("contextmenu",a=>{a.preventDefault(),a.stopPropagation(),m(),g(d,a.clientX,a.clientY)}),b.addEventListener("mousedown",()=>{m(),_(d,!0)}),A.addEventListener("mousedown",()=>{m(),v(d)});const f=(a,L)=>{const l=c.getBoundingClientRect(),S=a.clientX,N=a.clientY,W=ne(),C=W.width-l.left,O=W.height-l.top,E=t.width,u=t.height;document.body.style.userSelect="none";const R=p=>{let ie=l.left,oe=l.top;const B=we();if(L.x===1){let h=l.width+p.clientX-S;h>=E?h>=C&&(h=C):h=E,c.style.width=`${h}px`,h<l.width&&B&&_(d,!1)}else if(L.x===-1){let h=l.width-(p.clientX-S),w=l.left;p.clientX>=0?l.right-p.clientX<=E?(h=E,w=l.right-E):w=l.left+(p.clientX-S):(h=l.right,w=0),w<0&&(w=0),c.style.width=`${h}px`,ie=w,h<l.width&&B&&_(d,!1)}if(L.y===1){let h=l.height+p.clientY-N;h>=u?h>=O&&(h=O):h=u,c.style.height=`${h}px`,h<l.height&&B&&_(d,!1)}else if(L.y===-1){let h=l.height-(p.clientY-N),w=l.top;p.clientY>=0?l.bottom-p.clientY<=u?(h=u,w=l.bottom-u):w=l.top+(p.clientY-N):(h=l.bottom,w=0),w<0&&(w=0),c.style.height=`${h}px`,oe=w,h<l.height&&B&&_(d,!1)}c.style.translate=`${ie}px ${oe}px`},y=()=>{document.body.style.userSelect="unset",document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",y)};m(),document.addEventListener("mousemove",R),document.addEventListener("mouseup",y)};return F.addEventListener("mousedown",a=>f(a,{x:0,y:-1})),V.addEventListener("mousedown",a=>f(a,{x:0,y:1})),j.addEventListener("mousedown",a=>f(a,{x:-1,y:0})),K.addEventListener("mousedown",a=>f(a,{x:1,y:0})),G.addEventListener("mousedown",a=>f(a,{x:-1,y:-1})),J.addEventListener("mousedown",a=>f(a,{x:1,y:-1})),Q.addEventListener("mousedown",a=>f(a,{x:-1,y:1})),k.addEventListener("mousedown",a=>f(a,{x:1,y:1})),c.appendChild(F),c.appendChild(K),c.appendChild(V),c.appendChild(j),c.appendChild(G),c.appendChild(J),c.appendChild(Q),c.appendChild(k),c.appendChild(M),n!==null&&c.appendChild(q),c.style.minWidth=`${t.width}px`,c.style.minHeight=`${t.height}px`,c.style.translate=`${o.x}px ${o.y}px`,c.style.zIndex=(i+1).toString(),c.dataset.key=d,c},Xe="bar__modules",He="bar__modules__module";class De{constructor(e){r(this,"_barNode");r(this,"_modulesNode");r(this,"addModule",e=>{e.classList.add(He),this._modulesNode.appendChild(e)});this._barNode=e,this._modulesNode=document.createElement("div"),this._modulesNode.classList.add(Xe),this._barNode.appendChild(this._modulesNode),this._barNode.addEventListener("contextmenu",t=>t.preventDefault())}}class he{}r(he,"getTimeModule",()=>{const e=document.createElement("div"),t=()=>{const i=new Date,n=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;e.innerHTML=n};return t(),setInterval(()=>{t()},1e3),e});const _e=document.getElementById("desktop"),Ye=document.getElementById("window-manager"),Ue=document.getElementById("bar");fe(_e.querySelector(".desktop__info"));const X=new ze(Ye,_e),Ze=new De(Ue),D=document.createElement("p"),I=document.createElement("img");Ze.addModule(he.getTimeModule());D.innerHTML="Window Content";I.src="/img/test.gif";I.height=16;X.setDesktopContextMenu([{text:"New Window (Icon 1)",handler:({menuPosition:s})=>X.createWindow("Window","window",[D.cloneNode(!0),I.cloneNode(!0)],s)},{text:"New Window (Icon 2)",handler:({menuPosition:s})=>X.createWindow("Window","box",[D.cloneNode(!0),I.cloneNode(!0)],s)},{text:"New Window (Icon 3)",handler:({menuPosition:s})=>X.createWindow("Window","brilliance",[D.cloneNode(!0),I.cloneNode(!0)],s)}]);
