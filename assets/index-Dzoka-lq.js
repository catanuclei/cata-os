var pe=Object.defineProperty;var ge=(s,e,t)=>e in s?pe(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>ge(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const z={DISPLAY_NAME:"CataOS",VERSION:"0.0.1",AUTHOR:"catanuclei",COPYRIGHT_YEAR:"2024"},se=(()=>{const s=[];for(let e=0;e<10;e++)s.push(e.toString());for(let e=0;e<26;e++)s.push(String.fromCharCode(97+e));for(let e=0;e<26;e++)s.push(String.fromCharCode(65+e));return s})(),fe=s=>{const e=document.createElement("span"),t=document.createElement("span");e.innerHTML=`${z.DISPLAY_NAME} ${z.VERSION}`,t.innerHTML=`${z.AUTHOR} &copy; ${z.COPYRIGHT_YEAR}`,s.appendChild(e),s.appendChild(t)},ee=(s,e="")=>{const t=document.createElement("span");return e&&t.classList.add(e),t.classList.add("bi",`bi-${s}`),t};var Z=(s=>(s.FOCUS="CATA::FOCUS_EV",s.MAXIMIZE="CATA::MAXIMIZE_EV",s.UNMAXIMIZE="CATA::UNMAXIMIZE_EV",s))(Z||{});const de=s=>new CustomEvent("CATA::FOCUS_EV",{bubbles:!1,detail:{key:s}}),Ee=s=>new CustomEvent("CATA::MAXIMIZE_EV",{bubbles:!1,detail:{key:s}}),ae=(s,e=!0)=>new CustomEvent("CATA::UNMAXIMIZE_EV",{bubbles:!1,detail:{key:s,shift:e}}),Me="window",ce="window--focused",Ne="window__title",Le="window__title__icon",xe="window__title__text",Ae="window__title__buttons",re="window__title__button",te="window__title__maximize",Ce="window__title__close",Ie="window__content",M="window__resize-box",We="window__resize-box--top",Se="window__resize-box--right",Oe="window__resize-box--bottom",Re="window__resize-box--left",be="window__resize-box--top-left",ye="window__resize-box--top-right",ve="window__resize-box--bottom-left",Te="window__resize-box--bottom-right",De=6,B="context-menu",le="context-menu__item";class ze{constructor(e,t){c(this,"_managerNode");c(this,"_desktopNode");c(this,"_contextNode");c(this,"_windowMap");c(this,"_focusKey");c(this,"_isContextOpen");c(this,"_desktopContextItems");c(this,"_windowManagerWidth");c(this,"_windowManagerHeight");c(this,"createWindow",(e,t,i=null,n={x:0,y:0},o={width:96,height:72})=>{let d=this._generateWindowKey();for(;this._windowMap[d];)d=this._generateWindowKey();const w=Object.values(this._windowMap).length?Object.values(this._windowMap).sort((g,m)=>m.order-g.order)[0].order+1:0,O={title:e,icon:t,minDimensions:o,order:w,_premaximizeRect:null},X=Be(O,i,{x:(n==null?void 0:n.x)??0,y:(n==null?void 0:n.y)??0},d,this.maximizeWindow,this.closeWindow,this.focusWindow,(g,m,G)=>this.openContextMenu([{text:"Close",handler:()=>this.closeWindow(g)}],m,G),this.closeContextMenu,()=>!this._isContextOpen,()=>{var g;return!!((g=this._windowMap[d])!=null&&g._premaximizeRect)},()=>({width:this._windowManagerWidth,height:this._windowManagerHeight}));return this._managerNode.appendChild(X),this._windowMap[d]=O,this._shiftAndScaleOutOfBoundsWindow(d),this.focusWindow(d),{key:d}});c(this,"maximizeWindow",(e,t=!0)=>{if(this._windowMap[e]){if(!this._windowMap[e]._premaximizeRect){this._managerNode.dispatchEvent(de(e)),this._managerNode.dispatchEvent(Ee(e));return}this._managerNode.dispatchEvent(ae(e,t))}});c(this,"unmaximizeWindow",(e,t=!0)=>{this._windowMap[e]&&this._managerNode.dispatchEvent(ae(e,t))});c(this,"closeWindow",e=>{var i;if(!this._windowMap[e])return;(i=this._managerNode.querySelector(`[data-key="${e}"]`))==null||i.remove();const t=this._windowMap[e].order;Object.keys(this._windowMap).forEach(n=>{this._windowMap[n].order>t&&this._windowMap[n].order--}),delete this._windowMap[e]});c(this,"focusWindow",e=>{!this._windowMap[e]||this._focusKey===e||this._managerNode.dispatchEvent(de(e))});c(this,"openContextMenu",(e,t,i)=>{if(this.closeContextMenu(),!e.length)return;e.forEach(d=>{const w=document.createElement("li");w.innerHTML=d.text,w.classList.add(le),this._contextNode.appendChild(w)}),this._isContextOpen=!0,this._contextNode.classList.add(`${B}--shown`);const n=t+this._contextNode.offsetWidth>this._windowManagerWidth?t-this._contextNode.offsetWidth:t,o=i+this._contextNode.offsetHeight>this._windowManagerHeight?i-this._contextNode.offsetHeight:i;[...this._contextNode.children].forEach((d,w)=>{d.onclick=()=>{e[w].handler({menuPosition:{x:n,y:o}}),this.closeContextMenu()}}),this._contextNode.style.translate=`${n}px ${o}px`});c(this,"setDesktopContextMenu",e=>{this._desktopContextItems=e});c(this,"closeContextMenu",()=>{this._isContextOpen&&(this._contextNode.innerHTML="",this._contextNode.classList.remove(`${B}--shown`),this._isContextOpen=!1)});c(this,"_setupContextNode",()=>{this._contextNode.classList.add(B),this._desktopNode.appendChild(this._contextNode)});c(this,"_generateWindowKey",()=>{let e="";for(let t=0;t<De;t++)e+=se[Math.floor(Math.random()*se.length)];return e});c(this,"_focusWindow",e=>{if(e===null){[...this._managerNode.querySelectorAll("[data-key]")].forEach(n=>{n.classList.remove(ce)});return}const t=this._windowMap[e].order,i=Object.values(this._windowMap).sort((n,o)=>o.order-n.order)[0].order;Object.keys(this._windowMap).forEach(n=>{this._windowMap[n].order>t&&this._windowMap[n].order--}),this._windowMap[e].order=i,[...this._managerNode.querySelectorAll("[data-key]")].forEach(n=>{const o=n.dataset.key;n.style.zIndex=(this._windowMap[o].order+1).toString(),n.classList[e===o?"add":"remove"](ce)})});c(this,"_maximizeWindow",e=>{const t=this._managerNode.querySelector(`[data-key="${e}"]`);this._windowMap[e]._premaximizeRect=t.getBoundingClientRect(),t.style.translate="0px 0px",t.style.width=`${this._windowManagerWidth}px`,t.style.height=`${this._windowManagerHeight}px`;const i=t.querySelector(`.${te}`);i.classList.remove("bi-arrows-angle-expand"),i.classList.add("bi-arrows-angle-contract")});c(this,"_unmaximizeWindow",(e,t=!0)=>{const i=this._windowMap[e]._premaximizeRect;if(!i)return;const n=this._managerNode.querySelector(`[data-key="${e}"]`);t&&(n.style.translate=`${i.left}px ${i.top}px`,n.style.width=`${i.width}px`,n.style.height=`${i.height}px`);const o=n.querySelector(`.${te}`);o.classList.remove("bi-arrows-angle-contract"),o.classList.add("bi-arrows-angle-expand"),this._windowMap[e]._premaximizeRect=null,this._shiftAndScaleOutOfBoundsWindow(e)});c(this,"_shiftAndScaleOutOfBoundsWindows",()=>{[...this._managerNode.querySelectorAll("[data-key]")].forEach(e=>{const t=e.dataset.key,i=e.getBoundingClientRect(),n=this._windowMap[t]._premaximizeRect;let o=i.left,d=i.top;i.width>this._windowManagerWidth&&(e.style.width=`${this._windowManagerWidth}px`),i.height>this._windowManagerHeight&&(e.style.height=`${this._windowManagerHeight}px`),i.left>this._windowManagerWidth-e.offsetWidth?o=this._windowManagerWidth-e.offsetWidth:i.left<0&&(o=0),i.top>this._windowManagerHeight-e.offsetHeight?d=this._windowManagerHeight-e.offsetHeight:i.top<0&&(d=0);const w=e.getBoundingClientRect();n&&(this._windowManagerWidth>w.width||this._windowManagerHeight>w.height)&&this._unmaximizeWindow(t,!1),e.style.translate=`${o}px ${d}px`})});c(this,"_shiftAndScaleOutOfBoundsWindow",e=>{if(!this._windowMap[e])return;const t=this._managerNode.querySelector(`[data-key="${e}"]`),i=t.getBoundingClientRect(),n=this._windowMap[e]._premaximizeRect;let o=i.left,d=i.top;i.width>this._windowManagerWidth&&(t.style.width=`${this._windowManagerWidth}px`),i.height>this._windowManagerHeight&&(t.style.height=`${this._windowManagerHeight}px`),i.left>this._windowManagerWidth-t.offsetWidth?o=this._windowManagerWidth-t.offsetWidth:i.left<0&&(o=0),i.top>this._windowManagerHeight-t.offsetHeight?d=this._windowManagerHeight-t.offsetHeight:i.top<0&&(d=0);const w=t.getBoundingClientRect();n&&(this._windowManagerWidth>w.width||this._windowManagerHeight>w.height)&&this._unmaximizeWindow(e,!1),t.style.translate=`${o}px ${d}px`});c(this,"_initializeEventListeners",()=>{this._managerNode.addEventListener(Z.FOCUS,e=>{const t=e.detail.key;this._focusWindow(t)}),this._managerNode.addEventListener(Z.MAXIMIZE,e=>{const t=e.detail.key;this._maximizeWindow(t)}),this._managerNode.addEventListener(Z.UNMAXIMIZE,e=>{const t=e.detail.key,i=e.detail.shift;this._unmaximizeWindow(t,i??!0)})});const i=e.getBoundingClientRect();this._managerNode=e,this._desktopNode=t,this._contextNode=document.createElement("ul"),this._windowMap={},this._focusKey=null,this._isContextOpen=!1,this._desktopContextItems=[],this._windowManagerWidth=i.width,this._windowManagerHeight=i.height,this._setupContextNode();let n;window.addEventListener("resize",()=>{const o=this._managerNode.getBoundingClientRect();this._windowManagerWidth=o.width,this._windowManagerHeight=o.height,clearTimeout(n),n=setTimeout(this._shiftAndScaleOutOfBoundsWindows,150)}),window.addEventListener("mousedown",o=>{o.target.classList.contains(B)||o.target.classList.contains(le)||this.closeContextMenu()}),this._managerNode.addEventListener("contextmenu",o=>{o.preventDefault(),this.openContextMenu(this._desktopContextItems,o.clientX,o.clientY)}),this._managerNode.addEventListener("mousedown",()=>{this._focusWindow(null)}),this._contextNode.addEventListener("contextmenu",o=>{o.preventDefault()}),this._initializeEventListeners()}}const Be=({title:s,icon:e,minDimensions:t,order:i},n,o,d,w,O,X,g,m,G,ue,ne)=>{const r=document.createElement("div"),N=document.createElement("p"),U=document.createElement("span"),F=document.createElement("span"),R=document.createElement("div"),b=document.createElement("button"),_e=ee("arrows-angle-expand",te),y=document.createElement("button"),me=ee("x-lg",Ce),j=document.createElement("div"),V=document.createElement("div"),$=document.createElement("div"),P=document.createElement("div"),k=document.createElement("div"),J=document.createElement("div"),Q=document.createElement("div"),q=document.createElement("div"),K=document.createElement("div");V.classList.add(M,We),$.classList.add(M,Se),P.classList.add(M,Oe),k.classList.add(M,Re),J.classList.add(M,be),Q.classList.add(M,ye),q.classList.add(M,ve),K.classList.add(M,Te),r.classList.add(Me),N.classList.add(Ne),U.classList.add(Le),F.classList.add(xe),R.classList.add(Ae),b.classList.add(re),y.classList.add(re),j.classList.add(Ie),e&&U.appendChild(ee(e)),F.innerHTML=s,b.appendChild(_e),y.appendChild(me),R.appendChild(b),R.appendChild(y),e&&N.appendChild(U),N.appendChild(F),N.appendChild(R),n&&n.forEach(a=>{j.appendChild(a)}),N.addEventListener("mousedown",a=>{const L=r.offsetWidth,l=r.offsetHeight,C=r.getBoundingClientRect(),x=a.clientX-C.left,I=a.clientY-C.top,A=ne(),W=_=>{if(!G())return;const v=_.clientY-I<0?0:_.clientY-I>=A.height-l?A.height-l:_.clientY-I,T=_.clientX-x<0?0:_.clientX-x>=A.width-L?A.width-L:_.clientX-x;r.style.translate=`${T}px ${v}px`},E=()=>{document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",E)};m(),document.addEventListener("mousemove",W),document.addEventListener("mouseup",E)}),N.addEventListener("dblclick",a=>{a.stopPropagation(),m(),w(d,!0)}),r.addEventListener("mousedown",a=>{a.stopPropagation(),m(),X(d)}),r.addEventListener("contextmenu",a=>{a.preventDefault(),a.stopPropagation(),m(),g(d,a.clientX,a.clientY)}),b.addEventListener("mousedown",()=>{m(),w(d,!0)}),y.addEventListener("mousedown",()=>{m(),O(d)});const f=(a,L)=>{const l=r.getBoundingClientRect(),C=a.clientX,x=a.clientY,I=ne(),A=I.width-l.left,W=I.height-l.top,E=t.width,_=t.height;document.body.style.userSelect="none";const v=p=>{let ie=l.left,oe=l.top;const D=ue();if(L.x===1){let h=l.width+p.clientX-C;h>=E?h>=A&&(h=A):h=E,r.style.width=`${h}px`,h<l.width&&D&&w(d,!1)}else if(L.x===-1){let h=l.width-(p.clientX-C),u=l.left;p.clientX>=0?l.right-p.clientX<=E?(h=E,u=l.right-E):u=l.left+(p.clientX-C):(h=l.right,u=0),u<0&&(u=0),r.style.width=`${h}px`,ie=u,h<l.width&&D&&w(d,!1)}if(L.y===1){let h=l.height+p.clientY-x;h>=_?h>=W&&(h=W):h=_,r.style.height=`${h}px`,h<l.height&&D&&w(d,!1)}else if(L.y===-1){let h=l.height-(p.clientY-x),u=l.top;p.clientY>=0?l.bottom-p.clientY<=_?(h=_,u=l.bottom-_):u=l.top+(p.clientY-x):(h=l.bottom,u=0),u<0&&(u=0),r.style.height=`${h}px`,oe=u,h<l.height&&D&&w(d,!1)}r.style.translate=`${ie}px ${oe}px`},T=()=>{document.body.style.userSelect="unset",document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",T)};m(),document.addEventListener("mousemove",v),document.addEventListener("mouseup",T)};return V.addEventListener("mousedown",a=>f(a,{x:0,y:-1})),P.addEventListener("mousedown",a=>f(a,{x:0,y:1})),k.addEventListener("mousedown",a=>f(a,{x:-1,y:0})),$.addEventListener("mousedown",a=>f(a,{x:1,y:0})),J.addEventListener("mousedown",a=>f(a,{x:-1,y:-1})),Q.addEventListener("mousedown",a=>f(a,{x:1,y:-1})),q.addEventListener("mousedown",a=>f(a,{x:-1,y:1})),K.addEventListener("mousedown",a=>f(a,{x:1,y:1})),r.appendChild(V),r.appendChild($),r.appendChild(P),r.appendChild(k),r.appendChild(J),r.appendChild(Q),r.appendChild(q),r.appendChild(K),r.appendChild(N),n!==null&&r.appendChild(j),r.style.minWidth=`${t.width}px`,r.style.minHeight=`${t.height}px`,r.style.translate=`${o.x}px ${o.y}px`,r.style.zIndex=(i+1).toString(),r.dataset.key=d,r},He="bar__modules",Ze="bar__modules__module";class Ye{constructor(e){c(this,"_barNode");c(this,"_modulesNode");c(this,"addModule",e=>{e.classList.add(Ze),this._modulesNode.appendChild(e)});this._barNode=e,this._modulesNode=document.createElement("div"),this._modulesNode.classList.add(He),this._barNode.appendChild(this._modulesNode),this._barNode.addEventListener("contextmenu",t=>t.preventDefault())}}class he{}c(he,"getTimeModule",()=>{const e=document.createElement("div"),t=()=>{const i=new Date,n=`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`;e.innerHTML=n};return t(),setInterval(()=>{t()},1e3),e});const Xe="data:image/gif;base64,R0lGODlhYAAgAIAAAP///wAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDcuMS1jMDAwIDc5LmIwZjhiZTkwLCAyMDIxLzEyLzE1LTIxOjI1OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjMuMiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QzY0QjcyMDFCOUVFMTFFREEyNkRDMEFFQzQyMDdFMjAiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QzY0QjcyMDJCOUVFMTFFREEyNkRDMEFFQzQyMDdFMjAiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpDNjRCNzFGRkI5RUUxMUVEQTI2REMwQUVDNDIwN0UyMCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpDNjRCNzIwMEI5RUUxMUVEQTI2REMwQUVDNDIwN0UyMCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAkKAAEALAAAAABgACAAAAK9jG+gyO0Po1uySgWs3pry733iGI4Q9qCmiGWNur7lAcddTc82LtuVjuDtgDnfhRgQxpRF4wnJBCGd1OD0d61SoxaudpuNeL/GsThMXqJTa2zr7Sq3ZXEf/A6uk+bnu7nLZ6WX9iXkN5gUSHiDeDihuOj2iEcXmYajVPNnyYEJpAnJyaaXGbIpCkj6aRqKyuCJmNjYylkaa0hraTs66bqy21vpu3e7Ohs7fFS8fJZ8kwqX6owF/SY93ewWjVAAACH5BAUKAAEALAAAAABgACAAAALPjG+gyO0Po1uySgWs3pry733iGI4Q9qCmiGWNur7lAcddTc82LtuVjuDtgDnfhRgQxpRF4wnJBCGd1OD0d61SoxYuqZWVulZeMXjsLEfUmzP7hv7Gh6k5Geiu203KcFfnBuiHtTd4ZBeIaLiGtyfH0Bfydli3VRKJNslY6Mhy2Zi5+MRpGYdp1SlWmfbJGZrKEVkKCYo6OwHb1qpny0rqS+uKm/uXZ3Q6nHwcCKwso0hcDNb8zFuthZ0ExTyajR2V+Oe9PJ4gWt40rome7lMAADs=",we=document.getElementById("desktop"),Ge=document.getElementById("window-manager"),Ue=document.getElementById("bar");fe(we.querySelector(".desktop__info"));const H=new ze(Ge,we),Fe=new Ye(Ue),Y=document.createElement("p"),S=document.createElement("img");Fe.addModule(he.getTimeModule());Y.innerHTML="Window Content";S.src=Xe;S.height=16;H.setDesktopContextMenu([{text:"New Window (Icon 1)",handler:({menuPosition:s})=>H.createWindow("Window","window",[Y.cloneNode(!0),S.cloneNode(!0)],s)},{text:"New Window (Icon 2)",handler:({menuPosition:s})=>H.createWindow("Window","box",[Y.cloneNode(!0),S.cloneNode(!0)],s)},{text:"New Window (Icon 3)",handler:({menuPosition:s})=>H.createWindow("Window","brilliance",[Y.cloneNode(!0),S.cloneNode(!0)],s)}]);
